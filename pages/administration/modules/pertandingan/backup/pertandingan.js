let competitions = [];/* =========================================   EVENT CODE (MULTI EVENT SAFE)========================================= */const params = new URLSearchParams(window.location.search);const eventCode = params.get("event");if (!eventCode) {  alert("Event tidak ditemukan. Silakan login ulang.");  window.location.href = "/";}/* =========================================   INIT========================================= */export async function init() {  await loadData();  const btn = document.getElementById("addCompetitionBtn");  if (btn) {    btn.addEventListener("click", () => openModal());  }}/* =========================================   LOAD DATA========================================= */async function loadData() {  const res = await fetch(`/api/admin/match-number?eventCode=${eventCode}`);  competitions = await res.json();  renderList();}/* =========================================   SAVE========================================= */async function saveToServer(data) {  await fetch("/api/admin/match-number", {    method: "POST",    headers: { "Content-Type": "application/json" },    body: JSON.stringify({      eventCode,      matchNumber: data    })  });  await loadData();}/* =========================================   DELETE========================================= */async function deleteFromServer(id) {  await fetch("/api/admin/match-number", {    method: "DELETE",    headers: { "Content-Type": "application/json" },    body: JSON.stringify({      eventCode,      id    })  });  await loadData();}/* =========================================   MODAL========================================= */function openModal(editData = null) {  const modal = document.createElement("div");  modal.className = "modal";  modal.innerHTML = `    <div class="modal-box">      <h3>Input Nomor Pertandingan</h3>      <label>Nomor Pertandingan</label>      <select id="nomor">        <option>Double</option>        <option>Regu</option>        <option>Quadrant</option>      </select>      <label>Kategori</label>      <select id="kategori">        <option>Inter</option>        <option>Team</option>      </select>      <label>Gender</label>      <select id="gender">        <option>Putra</option>        <option>Putri</option>      </select>      <label>Sistem</label>      <select id="sistem">        <option>Knock Out</option>        <option>Kompetisi</option>        <option>Setengah Kompetisi</option>        <option>Group/Pool</option>      </select>      <label>Jumlah Peserta</label>      <input type="number" id="peserta">      <div id="groupOptions" style="display:none; margin-top:12px;">        <label>Jumlah Pool</label>        <input type="number" id="jumlahPool" value="6">        <div style="margin-top:12px;">          <div class="checkbox-row">            <input type="checkbox" id="juaraGroup">            <label for="juaraGroup">Juara Group</label>          </div>          <div class="checkbox-row">            <input type="checkbox" id="runnerUp">            <label for="runnerUp">Runner Up</label>          </div>          <div class="checkbox-row">            <input type="checkbox" id="best3">            <label for="best3">Best 3</label>            <input type="number"                   id="best3Jumlah"                   placeholder="Jumlah"                   style="display:none; width:70px;">          </div>        </div>      </div>      <div class="modal-actions">        <button class="primary" id="saveBtn">Simpan</button>        <button class="secondary" id="cancelBtn">Cancel</button>      </div>    </div>  `;  document.body.appendChild(modal);  /* =============================     AUTO FILL EDIT MODE  ============================= */  if (editData) {    nomor.value = editData.nomor;    kategori.value = editData.kategori;    gender.value = editData.gender;    sistem.value = editData.sistem;    peserta.value = editData.peserta;    jumlahPool.value = editData.jumlahPool || 6;    juaraGroup.checked = editData.juaraGroup || false;    runnerUp.checked = editData.runnerUp || false;    best3.checked = editData.best3 || false;    best3Jumlah.value = editData.best3Jumlah || "";  }  /* =============================     DYNAMIC BEHAVIOR  ============================= */  const sistemSelect = modal.querySelector("#sistem");  const groupOptions = modal.querySelector("#groupOptions");  const best3Checkbox = modal.querySelector("#best3");  const best3JumlahInput = modal.querySelector("#best3Jumlah");  function toggleGroupOptions() {    groupOptions.style.display =      sistemSelect.value === "Group/Pool" ? "block" : "none";  }  function toggleBest3() {    best3JumlahInput.style.display =      best3Checkbox.checked ? "inline-block" : "none";  }  sistemSelect.addEventListener("change", toggleGroupOptions);  best3Checkbox.addEventListener("change", toggleBest3);  toggleGroupOptions();  toggleBest3();  /* =============================     BUTTON ACTION  ============================= */  modal.querySelector("#cancelBtn").onclick = () => modal.remove();  modal.querySelector("#saveBtn").onclick = async () => {    const data = {      id: editData?.id,      nomor: nomor.value,      kategori: kategori.value,      gender: gender.value,      sistem: sistem.value,      peserta: peserta.value,      jumlahPool: jumlahPool?.value || null,      juaraGroup: juaraGroup?.checked || false,      runnerUp: runnerUp?.checked || false,      best3: best3?.checked || false,      best3Jumlah: best3Jumlah?.value || null    };    await saveToServer(data);    modal.remove();  };}/* =========================================   RENDER LIST========================================= */function renderList() {  const putra = document.getElementById("putraList");  const putri = document.getElementById("putriList");  putra.innerHTML = "";  putri.innerHTML = "";  competitions.forEach(c => {    const extra =      c.sistem === "Group/Pool"        ? `          <br>Pool: ${c.jumlahPool || "-"}          ${c.juaraGroup ? " | Juara Group" : ""}          ${c.runnerUp ? " | Runner Up" : ""}          ${c.best3 ? ` | Best ${c.best3Jumlah}` : ""}        `        : "";    const card = `      <div class="comp-card">        <div>          <strong>${c.nomor} - ${c.kategori}</strong><br>          ${c.sistem} | ${c.peserta} Peserta          ${extra}        </div>        <div class="comp-actions">          <button onclick="editComp(${c.id})">Edit</button>          <button onclick="drawingComp(${c.id})">Drawing</button>          <button onclick="deleteComp(${c.id})">Hapus</button>        </div>      </div>    `;    if (c.gender === "Putra") {      putra.innerHTML += card;    } else {      putri.innerHTML += card;    }  });}/* =========================================   GLOBAL ACTION========================================= */window.editComp = function (id) {  const data = competitions.find(c => c.id === id);  openModal(data);};window.deleteComp = function (id) {  if (confirm("Yakin ingin menghapus nomor pertandingan ini?")) {    deleteFromServer(id);  }};window.drawingComp = function (id) {  window.location.href =    `/pages/administration/pages/drawing.html?event=${eventCode}&matchId=${id}`;};